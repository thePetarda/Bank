DROP TABLE Wniosek_o_kredyt;
DROP TABLE Wniosek_o_zmiane;
DROP TABLE Powiadomienie;
DROP TABLE Kredyt;
DROP TABLE Skarbnica;
DROP TABLE Przelew_cykliczny;
DROP TABLE Historia;
DROP TABLE Wlasnosc;
DROP TABLE Konto;
DROP TABLE Pracownik;
DROP TABLE Klient;
DROP TABLE Użytkownik;

CREATE TABLE Użytkownik
(
    imie VARCHAR2(40) NOT NULL,
    nazwisko VARCHAR2(40) NOT NULL,
    haslo VARCHAR2(40) NOT NULL,
    mail VARCHAR2(40) NOT NULL,
    id NUMBER(4) PRIMARY KEY
);

CREATE TABLE Klient
(
    id NUMBER(4) REFERENCES Użytkownik PRIMARY KEY,
    adres VARCHAR2(40) NOT NULl,
    numer_tel VARCHAR2(9) NOT NULL
);

CREATE TABLE Pracownik
(
    id NUMBER(4) REFERENCES Użytkownik PRIMARY KEY,
    dzial VARCHAR2(40) NOT NULl,
    CONSTRAINT dobry_dzial CHECK (dzial IN ('Obslugi', 'Kredytu'))
);

CREATE TABLE Konto
(
    numer NUMBER(4) PRIMARY KEY,
    waluta CHAR(3) NOT NULL,
    stan NUMBER(9) NOT NULL
);

CREATE TABLE Wlasnosc
(
    id_wlasc NUMBER(4) NOT NULL REFERENCES Klient,
    nr_konto NUMBER(4) NOT NULL REFERENCES Konto,
    CONSTRAINT wlasnosc_pk PRIMARY KEY (id_wlasc, nr_konto)
);

CREATE TABLE Historia
(
    nr_konto NUMBER(4) PRIMARY KEY REFERENCES Konto,
    typ_operacji VARCHAR2(40) NOT NULL,
    kwota NUMBER(9) NOT NULL,
    data DATE NOT NULL,
    CONSTRAINT operacja_check CHECK (typ_operacji IN ('Wplata', 'Wyplata'))
);

CREATE TABLE Przelew_cykliczny
(
    id NUMBER(4) PRIMARY KEY,
    nr_nadawcy NUMBER(4) NOT NULL REFERENCES Konto,
    nr_odbiorcy NUMBER(4) NOT NULL REFERENCES Konto,
    kwota NUMBER(9) NOT NULL,
    CONSTRAINT kwota_cykl_check CHECK (kwota > 0),
    okres NUMBER(4) NOT NULL,
    CONSTRAINT okres_cykl_check CHECK (okres > 0),
    data DATE NOT NULL
);

CREATE TABLE Skarbnica
(
    id NUMBER(4) PRIMARY KEY,
    kwota NUMBER(9) NOT NULL
);

CREATE TABLE Kredyt
(
    id NUMBER(4) PRIMARY KEY,
    nr_konta NUMBER(4) NOT NULL REFERENCES Konto,
    skarbiec NUMBER(4) NOT NULL REFERENCES Skarbnica,
    oprocentowanie NUMBER(4) NOT NULL,
    CONSTRAINT oprocentowanie_kredyt_check CHECK (oprocentowanie > 0),
    okres NUMBER(4) NOT NULL,
    CONSTRAINT okres_kredyt_check CHECK (okres > 0),
    data DATE NOT NULL,
    czy_zmienne NUMBER(1) NOT NULL
);

CREATE TABLE Powiadomienie
(
    id_klient NUMBER(4) NOT NULL REFERENCES Klient,
    temat VARCHAR2(40) NOT NULL,
    tresc VARCHAR2(40) NOT NULL,
    data DATE NOT NULL,
    id NUMBER(4) PRIMARY KEY
);

CREATE TABLE Wniosek_o_zmiane
(
    id_klient NUMBER(4) NOT NULL REFERENCES Klient,
    id_pracownik NUMBER(4) NOT NULL REFERENCES Pracownik,
    nazwa_pola VARCHAR2(40) NOT NULL,
    CONSTRAINT dobre_pole CHECK (nazwa_pola IN ('imie', 'nazwisko', 'haslo', 'mail', 'adres', 'numer_tel')),
    nowa_wartosc VARCHAR2(40) NOT NULL,
    id NUMBER(4) PRIMARY KEY
);

CREATE TABLE Wniosek_o_kredyt
(
    id_klient NUMBER(4) NOT NULL REFERENCES Klient,
    id_pracownik NUMBER(4) NOT NULL REFERENCES Pracownik,
    kwota NUMBER(9) NOT NULL,
    CONSTRAINT kwota_wniosek_check CHECK (kwota > 0),
    oprocentowanie NUMBER(4) NOT NULL,
    CONSTRAINT oprocentowanie_wniosek_check CHECK (oprocentowanie > 0),
    czy_zmienne NUMBER(1) NOT NULL,
    id NUMBER(4) PRIMARY KEY
);
